# 일일결산 자동화 시스템 사용 가이드

## 🚀 출근 후 첫 실행 (필수!)

처음 사용하시거나 설정을 확인하려면:

```cmd
python pre_run_check.py
```

이 스크립트가 자동으로:
1. 모든 디렉토리 경로 확인
2. 실제 파일명 샘플 수집 (`directory_samples.txt` 생성)
3. 예약 엑셀 파일 읽기 테스트
4. 상세 리포트 생성

**중요**: 생성된 `directory_samples.txt` 파일을 Claude에게 보내서 패턴 분석을 받으세요!

자세한 가이드: `출근_후_체크리스트.md` 참조

---

## 빠른 시작 (Windows)

### 1단계: 설정 파일 확인

`config_real.json` 파일이 실제 경로로 설정되어 있습니다:

```json
{
  "SP": "\\\\192.168.0.120\\sp",
  "TOPO": "\\\\topo\\Topo",
  "ORB": "\\\\orb\\orb",
  "OCT": "\\\\192.168.0.221\\pdf",
  "HFA": "\\\\geomsa-main2\\hfa",
  "OQAS": "\\\\oqas\\oqass",
  "안저": ["\\\\AFC-210-PC\\Fundus2", "\\\\192.168.0.213\\[하위폴더]"]
}
```

**중요**: 안저 경로 중 `\\192.168.0.213\[하위폴더]`는 실제 하위폴더명으로 변경 필요
→ 자세한 내용: `안저_경로_설정_가이드.md` 참조

### 2단계: 폴더 구조 확인 (선택사항)

각 장비의 오늘 날짜 폴더 확인:

```cmd
python guess_today_folder.py
```

예상 폴더 구조:
- **TOPO**: `\\topo\Topo\2025\01\TOPO 01.18`
- **ORB**: `\\orb\orb\2025\2025.01\ORB 01.18`
- **OCT**: `\\192.168.0.221\pdf\2025\01\18`
- **OQAS**: `\\oqas\oqass\2025\01\18.01`
- **SP**: `\\192.168.0.120\sp` (단일 폴더, 생성일 체크)
- **HFA**: `\\geomsa-main2\hfa` (단일 폴더, 생성일 체크)

### 3단계: 프로그램 실행

```cmd
# config_real.json 사용
python daily_report_fast.py
```

또는 config.json 파일명 변경:
```cmd
copy config_real.json config.json
python daily_report_fast.py
```

## 주요 차이점

### backup.ps1 vs 일일결산
- **backup.ps1**: 어제 생성된 파일을 백업
- **일일결산**: 오늘 생성된 파일을 집계

### 속도 최적화
backup.ps1의 방식을 참고하여:

1. **오늘 날짜 폴더만 직접 접근**
   ```
   \\topo\Topo\2025\01\TOPO 01.18 폴더만 스캔
   전체 \\topo\Topo 폴더를 탐색하지 않음
   ```

2. **생성일 체크 최소화**
   - 폴더 구조로 날짜 필터링
   - `os.path.getctime()` 호출 최소화

3. **os.walk() 사용**
   - 오늘 폴더 내부만 재귀 탐색
   - Path.rglob() 대신 빠른 os.walk()

## 폴더 구조별 스캔 방식

### A. 날짜별 폴더 구조 (빠름 ⚡)
- **TOPO, ORB, OCT, OQAS**
- 오늘 폴더만 직접 접근 → os.walk()
- 예상 시간: 1-2초

### B. 단일 폴더 + 파일명 날짜 (중간 🟡)
- **SP**
- 폴더 내 파일명에서 날짜 추출
- `_20250118.` 패턴 매칭
- 예상 시간: 3-5초

### C. 단일 폴더 + 생성일 체크 (상대적으로 느림 🟠)
- **HFA, 안저**
- 각 파일의 `os.path.getctime()` 확인
- 하지만 오늘 파일만 있으므로 여전히 빠름
- 예상 시간: 5-10초

## 예상 총 실행 시간
- **전체 스캔**: 10-15초
- **엑셀 작성**: 1-2초
- **PDF 변환**: 3-5초
- **총합**: 약 15-20초

## 문제 해결

### 안저 경로 설정 (필수)
안저 검사의 두 번째 경로가 미확정 상태입니다:

```cmd
python find_fundus_path.py
```

이 스크립트를 실행하면:
- `\\192.168.0.213\` 하위의 Fundus 폴더를 자동으로 찾음
- 찾은 경로를 `config_real.json`에 업데이트

자세한 가이드: `안저_경로_설정_가이드.md` 참조

### "경로 없음" 오류
```
⚠️ 경로 없음: \\topo\Topo\2025\01\TOPO 01.18
```

해결방법:
1. 폴더 구조가 다른지 확인
2. `guess_today_folder.py` 실행해서 실제 경로 확인
3. `config_real.json`의 `folder_structure` 수정

### 너무 느린 경우
1. 네트워크 연결 상태 확인
2. 백업 폴더(`D:\BACKUP\*`) 사용 고려
3. 로그에서 어느 장비가 느린지 확인

## 백업 폴더 사용 옵션

네트워크가 느린 경우, backup.ps1로 백업된 폴더 사용:

```json
{
  "SP": "D:\\BACKUP\\SP",
  "TOPO": "D:\\BACKUP\\TOPO",
  "ORB": "D:\\BACKUP\\ORB",
  ...
}
```

단, 백업은 **어제** 파일이므로 **당일 결산엔 사용 불가!**
